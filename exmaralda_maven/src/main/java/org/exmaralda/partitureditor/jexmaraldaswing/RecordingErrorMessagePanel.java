/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package org.exmaralda.partitureditor.jexmaraldaswing;

import java.awt.Desktop;
import java.io.File;
import java.io.IOException;
import java.net.URISyntaxException;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.event.HyperlinkEvent;

/**
 *
 * @author thomas.schmidt
 */
public class RecordingErrorMessagePanel extends javax.swing.JPanel {

    String filePath;
    Exception exception;
    String player;
    
    /**
     * Creates new form RecordingErrorMesagePanel
     */
    public RecordingErrorMessagePanel(String filePath, Exception ex, String preferencesNode) {
        this.filePath = filePath;
        this.exception = ex;
        java.util.prefs.Preferences settings =
                java.util.prefs.Preferences.userRoot().node(preferencesNode);        
        player = settings.get("PlayerType", "");
        
        initComponents();
        
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jScrollPane1 = new javax.swing.JScrollPane();
        messageEditorPane = new javax.swing.JEditorPane();

        setLayout(new java.awt.BorderLayout());

        messageEditorPane.setEditable(false);
        messageEditorPane.setBackground(new java.awt.Color(226, 214, 204));
        messageEditorPane.setContentType("text/html"); // NOI18N
        messageEditorPane.setText(getMessageText());
        messageEditorPane.addHyperlinkListener(new javax.swing.event.HyperlinkListener() {
            public void hyperlinkUpdate(javax.swing.event.HyperlinkEvent evt) {
                messageEditorPaneHyperlinkUpdate(evt);
            }
        });
        jScrollPane1.setViewportView(messageEditorPane);

        add(jScrollPane1, java.awt.BorderLayout.CENTER);
    }// </editor-fold>//GEN-END:initComponents

    private void messageEditorPaneHyperlinkUpdate(javax.swing.event.HyperlinkEvent evt) {//GEN-FIRST:event_messageEditorPaneHyperlinkUpdate
        try {
            if (evt.getEventType().equals(HyperlinkEvent.EventType.ACTIVATED)){
                Desktop.getDesktop().browse(evt.getURL().toURI());
            }
        } catch (IOException | URISyntaxException ex) {
            Logger.getLogger(RecordingErrorMessagePanel.class.getName()).log(Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_messageEditorPaneHyperlinkUpdate


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JEditorPane messageEditorPane;
    // End of variables declaration//GEN-END:variables

    private String getMessageText() {
        StringBuilder sb = new StringBuilder();
        
        sb.append("<html><body>");
        sb.append("<p>There was a problem opening the file: </p>");
        sb.append("<p><b>" + filePath + "</b></p>");
        sb.append("<p>General reasons for this error are that the file does not exist or it is in some format not supported by the current configuration.</p>");
        sb.append("<p>Error message: </p>");
        sb.append("<p style=\"font-family: Courier monospace; font-size:10pt;\">" + exception.getLocalizedMessage() + "</p>");
        if (!(new File(filePath).exists())){
            sb.append("<p style=\"color:red;\">The file does not seem to exist under the specified path</p>");            
        }
        sb.append("<p>You have currently set your player preference to: <b>" + player + "</b></p>");
        sb.append("<p>Try one of the following:<br/>"
                + "(1) Edit the recordings associated with this transcription<br/>"
                + "(2) Use a different media player (Edit > Preferences > Media)<br/>"
                + "</p>");
        sb.append("<p>Consult <a href=\"https://exmaralda.org/media/Quickstart_audio_and_video_support_EN_17.11.20.pdf\">this document</a> for further information on audio and video support in EXMARaLDA</p>");
        sb.append("<p> </p>");
        
        
        sb.append("</body></html>");
        return sb.toString();
    }
}
